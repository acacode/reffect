{"version":3,"file":"reffect-undoable.cjs.js","sources":["src/index.ts"],"sourcesContent":["import { StoreType, manage } from \"@reffect/core\";\n\ntype Undoable = {\n  undo: VoidFunction;\n  redo: VoidFunction;\n};\n\nexport const undoable = <Store extends StoreType>(store: Store, undoSize: number = 10): Undoable => {\n  const storeManager = manage(store);\n\n  const past: Store[] = [];\n  let present: Store = storeManager.initialState as Store;\n  const future: Store[] = [];\n\n  let updateFromLib = false;\n\n  storeManager.subscribe((partialUpdate, prevState, currState) => {\n    if (updateFromLib) {\n      updateFromLib = false;\n    } else {\n      if (future.length) {\n        future.splice(0, future.length);\n      }\n      if (past.length >= undoSize) {\n        past.shift();\n      }\n      past.push(prevState);\n      present = currState;\n    }\n  });\n\n  const undo = () => {\n    if (past.length) {\n      const lastPast = past.pop();\n      if (lastPast) {\n        future.unshift(present);\n        present = lastPast;\n        updateFromLib = true;\n        storeManager.partialUpdate(present);\n      }\n    }\n  };\n\n  const redo = () => {\n    if (future.length) {\n      const firstFuture = future.shift();\n      if (firstFuture) {\n        past.push(present);\n        present = firstFuture;\n        updateFromLib = true;\n        storeManager.partialUpdate(present);\n      }\n    }\n  };\n\n  return {\n    undo,\n    redo,\n  };\n};\n"],"names":["store","undoSize","storeManager","manage","past","present","initialState","future","updateFromLib","subscribe","partialUpdate","prevState","currState","length","splice","shift","push","undo","lastPast","pop","unshift","redo","firstFuture"],"mappings":"uGAOwB,CAA0BA,EAAcC,EAAmB,MACjF,MAAMC,EAAeC,SAAOH,GAEtBI,EAAgB,GACtB,IAAIC,EAAiBH,EAAaI,aAClC,MAAMC,EAAkB,GAExB,IAAIC,GAAgB,EAyCpB,OAvCAN,EAAaO,UAAU,CAACC,EAAeC,EAAWC,KAC5CJ,EACFA,GAAgB,GAEZD,EAAOM,QACTN,EAAOO,OAAO,EAAGP,EAAOM,QAEPZ,EAAfG,EAAKS,QACPT,EAAKW,QAEPX,EAAKY,KAAKL,GACVN,EAAUO,KA4BP,CACLK,KAzBW,KACX,GAAIb,EAAKS,OAAQ,CACf,MAAMK,EAAWd,EAAKe,MAClBD,IACFX,EAAOa,QAAQf,GACfA,EAAUa,EACVV,GAAgB,EAChBN,EAAaQ,cAAcL,MAmB/BgB,KAdW,KACX,GAAId,EAAOM,OAAQ,CACjB,MAAMS,EAAcf,EAAOQ,QACvBO,IACFlB,EAAKY,KAAKX,GACVA,EAAUiB,EACVd,GAAgB,EAChBN,EAAaQ,cAAcL"}